{"version":3,"sources":["models.ts","DisplayBoard.tsx","GraphRenderer.tsx","helpers/useMeasures.ts","helpers/isMobile.ts","NationTabVisualizer.tsx","helpers/sanitizers.ts","ProvinceTabVisualizer.tsx","About.tsx","ErrorBoundary.tsx","GeoVisualizer.tsx","theme.ts","App.tsx","serviceWorker.ts","index.tsx"],"names":["EMPTY_REGION_DATA","confirmed","discharged","deceased","suspected","BuildScale","mapping","filter","fn","configure","TextLabelDisplayLevel","FILL_FN_MAP","d3","scale","exponent","FILL_FN_PROVINCE_MAP","FILTER_INTERPOLATION","filterRegionNameByListAndLength","label","length","blackList","whiteList","display","indexOf","PROVINCE_META_MAP","filenamePrefix","projection","parallels","rotate","center","projectionMobile","showMobileRegion","showRegion","FILTER_MESSAGES","id","description","defaultMessage","STRIP_KEY_PARTS","MOBILE_DISPLAY_PROVINCE","NOT_MOBILE_REJECT_PROVINCE","NOT_MOBILE_ACCEPT_PROVINCE","DATE_RANGE","Date","messages","defineMessages","date","DisplayBoard","withStyles","spacing","palette","createStyles","filterButton","minWidth","color","darken","text","primary","root","margin","formControl","share","textLabelLevel","setTextLabelLevel","redirectionHint","classes","name","subName","data","onClick","selectedDate","handleDateChange","intl","useIntl","START_DATE","END_DATE","Card","CardHeader","title","subheader","CardContent","className","DatePicker","disableToolbar","minDate","maxDate","format","variant","formatMessage","value","onChange","toDate","inputVariant","animateYearScrolling","FormControl","InputLabel","Select","e","preventDefault","num","parseInt","String","target","isNaN","Auto","labelWidth","inputProps","MenuItem","Enabled","Disabled","ToggleButtonGroup","size","aria-label","ToggleButton","selected","Skeleton","Fragment","Link","GraphRenderer","showTextLabel","features","fillFn","geoGenerator","eventHandlers","ref","useRef","useEffect","remove","current","u","selectAll","enter","p","append","attr","d","centroid","properties","exit","forEach","typenames","listener","on","useMeasures","values","containerRef","React","measureRef","width","height","dimension","setDimension","docRect","getBoundingClientRect","measureRect","top","mapYBoundRaw","bounds","maxHeight","Infinity","Math","max","isMobile","MobileDetect","window","navigator","userAgent","mobile","TryGetDataFromPrefix","byProvince","prefix","keys","idx","findIndex","startsWith","get","filters","nation","NationTabVisualizer","transitions","gradLegend","setFilter","dataState","state","moveOverRegionPanel","useState","province","setProvince","useTitle","region","setByProvince","byDate","reduce","h","obj","Object","assign","updatedAtDate","concat","chosenDate","toISOString","substr","extracted","newDate","console","log","key","rollup","map","domain","interpolate","useCallback","provinceName","PluckDataByFilter","setData","total","entries","acc","item","pinned","setPinned","hovered","setHovered","onItemOver","ele","transition","duration","style","this","feature","diff","getTime","isMobileDevice","gradRef","createRef","s","w","legend","y","range","yAxis","ticks","call","Container","Grid","container","md","xs","undefined","Paper","loading","CircularProgress","stripRegionNameForKey","v","replace","byMapped","all","ProvinceTabVisualizer","highlightRow","backgroundColor","emphasize","background","params","provinceKey","provinceMeta","Error","city","setCity","byCity","setByCity","useAsync","a","Promise","resolve","TableContainer","component","Table","TableHead","TableRow","TableCell","align","TableBody","row","About","Typography","github","href","caixin","caixin2","ErrorBoundary","zIndex","mixins","breakpoints","props","hasError","error","errorInfo","children","getDerivedStateFromError","about","TabPanel","index","other","role","hidden","aria-labelledby","a11yProps","GeoVisualizer","appBarSpacer","minHeight","location","path","URLSearchParams","search","setRegion","defaultValue","setValue","stateProvince","regionKey","reject","getRegionUrl","regionName","set","redirectUrl","navigate","theme","useTheme","matches","useMediaQuery","up","routeFilter","trim","defaultFilter","setFilterPushingHistory","pathname","now","paramDate","defaultDate","setSelectedDate","CssBaseline","AppBar","position","Tabs","event","newValue","centered","Tab","disabled","typography","h1","fontSize","h2","h3","h4","h5","h6","App","prefersDarkMode","useMemo","createMuiTheme","type","useEffectOnce","moment","updateLocale","longDateFormat","LT","LTS","L","LL","LLL","LLLL","locale","ThemeProvider","MuiPickersUtilsProvider","utils","MomentUtils","Boolean","hostname","match","ReactDOM","render","document","getElementById","serviceWorker","ready","then","registration","unregister"],"mappings":"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","file":"static/js/main.dc2639af.chunk.js","sourcesContent":["import * as d3 from \"d3\";\n\nexport interface IRegionData {\n  confirmed: number;\n  discharged: number;\n  deceased: number;\n  suspected: number;\n  name?: string;\n}\n\nexport const EMPTY_REGION_DATA: IRegionData = {\n  confirmed: 0,\n  discharged: 0,\n  deceased: 0,\n  suspected: 0\n}\n\nexport interface AreaCsvLine {\n  name: string;\n  confirmed: number;\n  discharged: number;\n  deceased: number;\n  suspected: number;\n  updatedAtDate: string;\n}\n\nexport interface AreaCsvItem {\n  name: string;\n  confirmed: number;\n  discharged: number;\n  deceased: number;\n  suspected: number;\n  updatedAtDate: string;\n}\n\nexport type FilterType = \"confirmed\" | \"discharged\" | \"deceased\" | \"suspected\";\n\n// TODO: generic\nexport function BuildScale(mapping: Record<FilterType, [() => d3.ScalePower<number, number>, (scale: d3.ScalePower<number, number>) => d3.ScalePower<number, number>]>, filter: FilterType): d3.ScalePower<number, number>\n{\n  const [fn, configure] = mapping[filter];\n  const scale = fn();\n  return configure(scale);\n}\n\nexport const FILL_FN_MAP: Record<FilterType, [() => d3.ScalePower<number, number>, (scale: d3.ScalePower<number, number>) => d3.ScalePower<number, number>]> = {\n  \"discharged\": [d3.scalePow, (scale) => scale.exponent(0.3)],\n  \"deceased\": [d3.scalePow, (scale) => scale.exponent(0.2)],\n  \"confirmed\": [d3.scalePow, (scale) => scale.exponent(0.1)],\n  \"suspected\": [d3.scalePow, (scale) => scale.exponent(0.3)],\n};\n\nexport const FILL_FN_PROVINCE_MAP: Record<FilterType, [() => d3.ScalePower<number, number>, (scale: d3.ScalePower<number, number>) => d3.ScalePower<number, number>]> = {\n  \"discharged\": [d3.scalePow, (scale) => scale.exponent(1.2)],\n  \"deceased\": [d3.scalePow, (scale) => scale.exponent(1.5)],\n  \"confirmed\": [d3.scalePow, (scale) => scale.exponent(2)],\n  \"suspected\": [d3.scalePow, (scale) => scale.exponent(0.3)],\n};\n\nexport const FILTER_INTERPOLATION: Record<FilterType, (t: number) => string> = {\n  \"discharged\": d3.interpolateGreens,\n  \"deceased\": d3.interpolatePurples,\n  \"confirmed\": d3.interpolateOranges,\n  \"suspected\": d3.interpolateInferno\n}\n\nexport interface IProvinceMeta {\n  filenamePrefix: string;\n  projection: d3.GeoConicProjection;\n  projectionMobile: d3.GeoConicProjection;\n  showMobileRegion?: (label: string) => boolean;\n  showRegion?: (label: string) => boolean;\n}\n\nexport interface IDimension {\n  width: number;\n  height: number;\n}\n\n\nexport const MOBILE_WIDTH_BREAKPOINT = 550;\n\nconst filterRegionNameByListAndLength = (label: string, length: number | null, blackList: Array<string> | null, whiteList: Array<string> | null) => {\n  let display = true;\n  if (length) {\n    display = label.length <= length;\n  }\n  if (blackList && display) {\n    display = blackList.indexOf(label) === -1;\n  }\n  if (whiteList && !display) {\n    display = whiteList.indexOf(label) !== -1;\n  }\n  return display;\n}\n\nexport const PROVINCE_META_MAP: Record<string, IProvinceMeta> = {\n  '安徽': {\n    filenamePrefix: 'an_hui',\n    projection: d3.geoConicEqualArea()\n      .parallels([15, 65])\n      .rotate([-110, 0])\n      .scale(5500)\n      .center([11, 148]),\n    projectionMobile: d3.geoConicEqualArea()\n      .parallels([15, 65])\n      .rotate([-110, 0])\n      .scale(4500)\n      .center([12.5, 148.5]),\n    showMobileRegion: (label) => filterRegionNameByListAndLength(label, 3, ['淮北市', '淮南市', '铜陵市'], null),\n  },\n  '澳门': {\n    filenamePrefix: 'ao_men',\n    projection: d3.geoConicEqualArea()\n      .parallels([15, 65])\n      .rotate([-110, 0])\n      .scale(3000)\n      .center([10.1, 140.6]),\n    projectionMobile: d3.geoConicEqualArea()\n      .parallels([15, 65])\n      .rotate([-110, 0])\n      .scale(5500)\n      .center([11, 148])\n  },\n  '北京': {\n    filenamePrefix: 'bei_jing',\n    projection: d3.geoConicEqualArea()\n      .parallels([15, 65])\n      .rotate([-110, 0])\n      .scale(17000)\n      .center([7.7, 139.7]),\n    projectionMobile: d3.geoConicEqualArea()\n      .parallels([15, 65])\n      .rotate([-110, 0])\n      .scale(13000)\n      .center([8.43, 140]),\n    showMobileRegion: (label) => filterRegionNameByListAndLength(label, null, ['石景山区', '西城区', '东城区'], null),\n    showRegion: (label) => filterRegionNameByListAndLength(label, null, ['石景山区', '西城区', '东城区'], null),\n  },\n  '重庆': {\n    filenamePrefix: 'chong_qing',\n    projection: d3.geoConicEqualArea()\n      .parallels([15, 65])\n      .rotate([-110, 0])\n      .scale(6500)\n      .center([0.4, 149.8]),\n    projectionMobile: d3.geoConicEqualArea()\n      .parallels([15, 65])\n      .rotate([-110, 0])\n      .scale(4500)\n      .center([2.8, 150.4]),\n    showMobileRegion: (label) => (label.length < 4 && ['大足县', '垫江县', '奉节县', '铜梁县', '璧山县', '梁平县', '巫山县', '荣昌县'].indexOf(label) === -1 && label.indexOf('区') === -1) || [\"江津区\", \"南川区\", \"北碚区\", \"涪陵区\", '万州区'].indexOf(label) !== -1,\n    showRegion: (label) => (label.length < 4 && ['垫江县', '奉节县', '璧山县', '梁平县', '巫山县', '荣昌县'].indexOf(label) === -1 && label.indexOf('区') === -1) || [\"江津区\", \"南川区\", \"北碚区\", \"涪陵区\", '巴南区', '万州区'].indexOf(label) !== -1,\n  },\n  '福建': {\n    filenamePrefix: 'fu_jian',\n    projection: d3.geoConicEqualArea()\n      .parallels([15, 65])\n      .rotate([-110, 0])\n      .scale(6300)\n      .center([11, 153.9]),\n    projectionMobile: d3.geoConicEqualArea()\n      .parallels([15, 65])\n      .rotate([-110, 0])\n      .scale(4700)\n      .center([12.7, 154.7]),\n  },\n  '甘肃': {\n    filenamePrefix: 'gan_su',\n    projection: d3.geoConicEqualArea()\n      .parallels([15, 65])\n      .rotate([-110, 0])\n      .scale(2200)\n      .center([-0.5, 142]),\n    projectionMobile: d3.geoConicEqualArea()\n      .parallels([15, 65])\n      .rotate([-110, 0])\n      .scale(1500)\n      .center([7.5, 145]),\n    showMobileRegion: (label) => filterRegionNameByListAndLength(label, 4, ['平凉市', '白银市', '金昌市'], null),\n    showRegion: (label) => filterRegionNameByListAndLength(label, 4, ['平凉市', '白银市', '金昌市'], null),\n  },\n  '广东': {\n    filenamePrefix: 'guang_dong',\n    projection: d3.geoConicEqualArea()\n      .parallels([15, 65])\n      .rotate([-110, 0])\n      .scale(3800)\n      .center([7.7, 158]),\n    projectionMobile: d3.geoConicEqualArea()\n      .parallels([15, 65])\n      .rotate([-110, 0])\n      .scale(2600)\n      .center([11.0, 160]),\n    showMobileRegion: (label) => filterRegionNameByListAndLength(label, null, ['东莞市', '中山市', '惠州市', '揭阳市', '江门市', '阳江市'], null),\n  },\n  '广西': {\n    filenamePrefix: 'guang_xi',\n    projection: d3.geoConicEqualArea()\n      .parallels([15, 65])\n      .rotate([-110, 0])\n      .scale(4000)\n      .center([2.3, 157]),\n    projectionMobile: d3.geoConicEqualArea()\n      .parallels([15, 65])\n      .rotate([-110, 0])\n      .scale(2800)\n      .center([5.5, 158.5]),\n  },\n  '贵州': {\n    filenamePrefix: 'gui_zhou',\n    projection: d3.geoConicEqualArea()\n      .parallels([15, 65])\n      .rotate([-110, 0])\n      .scale(5000)\n      .center([0, 153.3]),\n    projectionMobile: d3.geoConicEqualArea()\n      .parallels([15, 65])\n      .rotate([-110, 0])\n      .scale(3500)\n      .center([2.8, 154.5]),\n    showMobileRegion: (label) => filterRegionNameByListAndLength(label, 6, null, null),\n    showRegion: (label) => filterRegionNameByListAndLength(label, null, ['黔南布依族苗族自治州'], null),\n  },\n  '海南': {\n    filenamePrefix: 'hai_nan',\n    projection: d3.geoConicEqualArea()\n      .parallels([15, 65])\n      .rotate([-110, 0])\n      .scale(10000)\n      .center([1.5, 161]),\n    projectionMobile: d3.geoConicEqualArea()\n      .parallels([15, 65])\n      .rotate([-110, 0])\n      .scale(7000)\n      .center([2.7, 161.6]),\n    showMobileRegion: (label) => filterRegionNameByListAndLength(label, 4, ['澄迈县'], null),\n  },\n  '河北': {\n    filenamePrefix: 'he_bei',\n    projection: d3.geoConicEqualArea()\n      .parallels([15, 65])\n      .rotate([-110, 0])\n      .scale(4000)\n      .center([12, 140.6]),\n    projectionMobile: d3.geoConicEqualArea()\n      .parallels([15, 65])\n      .rotate([-110, 0])\n      .scale(4000)\n      .center([13, 140.6]),\n  },\n  '河南': {\n    filenamePrefix: 'he_nan',\n    projection: d3.geoConicEqualArea()\n      .parallels([15, 65])\n      .rotate([-110, 0])\n      .scale(5500)\n      .center([6.9, 146]),\n    projectionMobile: d3.geoConicEqualArea()\n      .parallels([15, 65])\n      .rotate([-110, 0])\n      .scale(3800)\n      .center([9.6, 147.2]),\n    showMobileRegion: (label) => filterRegionNameByListAndLength(label, 3, ['鹤壁市'], ['驻马店市'])\n  },\n  '黑龙江': {\n    filenamePrefix: 'hei_long_jiang',\n    projection: d3.geoConicEqualArea()\n      .parallels([15, 65])\n      .rotate([-110, 0])\n      .scale(3000)\n      .center([25.5, 132]),\n    projectionMobile: d3.geoConicEqualArea()\n      .parallels([15, 65])\n      .rotate([-110, 0])\n      .scale(2100)\n      .center([30.8, 134.5]),\n    showMobileRegion: (label) => filterRegionNameByListAndLength(label, null, ['七台河市', '伊春市', '佳木斯市'], null),\n    showRegion: (label) => filterRegionNameByListAndLength(label, null, ['七台河市'], null),\n  },\n  '湖北': {\n    filenamePrefix: 'hu_bei',\n    projection: d3.geoConicEqualArea()\n      .parallels([15, 65])\n      .rotate([-110, 0])\n      .scale(4200)\n      .center([6.5, 150]),\n    projectionMobile: d3.geoConicEqualArea()\n      .parallels([15, 65])\n      .rotate([-110, 0])\n      .scale(2900)\n      .center([9.8, 151.5]),\n      showMobileRegion: (label) => filterRegionNameByListAndLength(label, 4, ['仙桃市', '鄂州市', '孝感市', '天门市', '黄石市'], null),\n    showRegion: (label) => filterRegionNameByListAndLength(label, 6, ['仙桃市', '鄂州市'], null),\n  },\n  '湖南': {\n    filenamePrefix: 'hu_nan',\n    projection: d3.geoConicEqualArea()\n      .parallels([15, 65])\n      .rotate([-110, 0])\n      .scale(5500)\n      .center([4.8, 152.3]),\n    projectionMobile: d3.geoConicEqualArea()\n      .parallels([15, 65])\n      .rotate([-110, 0])\n      .scale(4000)\n      .center([6.8, 153.2]),\n    showMobileRegion: (label) => filterRegionNameByListAndLength(label, 5, null, null),\n    showRegion: (label) => filterRegionNameByListAndLength(label, null, ['湘西土家族苗族自治州'], null),\n  },\n  '吉林': {\n    filenamePrefix: 'ji_lin',\n    projection: d3.geoConicEqualArea()\n      .parallels([15, 65])\n      .rotate([-110, 0])\n      .scale(4000)\n      .center([21.4, 137.5]),\n    projectionMobile: d3.geoConicEqualArea()\n      .parallels([15, 65])\n      .rotate([-110, 0])\n      .scale(2800)\n      .center([25, 139.7]),\n    showMobileRegion: (label) => filterRegionNameByListAndLength(label, 4, null, null),\n  },\n  '江苏': {\n    filenamePrefix: 'jiang_su',\n    projection: d3.geoConicEqualArea()\n      .parallels([15, 65])\n      .rotate([-110, 0])\n      .scale(5600)\n      .center([12.4, 147.4]),\n    projectionMobile: d3.geoConicEqualArea()\n      .parallels([15, 65])\n      .rotate([-110, 0])\n      .scale(3800)\n      .center([15.1, 148.7]),\n    showMobileRegion: (label) => filterRegionNameByListAndLength(label, null, ['泰州市', '镇江市', '无锡市', '常州市'], null),\n    showRegion: (label) => filterRegionNameByListAndLength(label, null, ['无锡市'], null),\n  },\n  '江西': {\n    filenamePrefix: 'jiang_xi',\n    projection: d3.geoConicEqualArea()\n      .parallels([15, 65])\n      .rotate([-110, 0])\n      .scale(5000)\n      .center([9, 152.5]),\n    projectionMobile: d3.geoConicEqualArea()\n      .parallels([15, 65])\n      .rotate([-110, 0])\n      .scale(4300)\n      .center([11, 153.2]),\n  },\n  '辽宁': {\n    filenamePrefix: 'liao_ning',\n    projection: d3.geoConicEqualArea()\n      .parallels([15, 65])\n      .rotate([-110, 0])\n      .scale(5500)\n      .center([16, 139]),\n    projectionMobile: d3.geoConicEqualArea()\n      .parallels([15, 65])\n      .rotate([-110, 0])\n      .scale(4000)\n      .center([18.6, 140.2]),\n  },\n  '内蒙古': {\n    filenamePrefix: 'nei_meng_gu',\n    projection: d3.geoConicEqualArea()\n      .parallels([15, 65])\n      .rotate([-110, 0])\n      .scale(1500)\n      .center([15.2, 135.5]),\n    projectionMobile: d3.geoConicEqualArea()\n      .parallels([15, 65])\n      .rotate([-110, 0])\n      .scale(1000)\n      .center([26.8, 141]),\n    showMobileRegion: (label) => filterRegionNameByListAndLength(label, 4, ['乌海市'], ['鄂尔多斯市', '锡林郭勒盟', '呼伦贝尔市']),\n    showRegion: (label) => filterRegionNameByListAndLength(label, 4, ['乌海市'], ['鄂尔多斯市', '锡林郭勒盟', '呼伦贝尔市']),\n  },\n  '宁夏': {\n    filenamePrefix: 'ning_xia',\n    projection: d3.geoConicEqualArea()\n      .parallels([15, 65])\n      .rotate([-110, 0])\n      .scale(6500)\n      .center([0, 142.5]),\n    projectionMobile: d3.geoConicEqualArea()\n      .parallels([15, 65])\n      .rotate([-110, 0])\n      .scale(5500)\n      .center([11, 148])\n  },\n  '青海': {\n    filenamePrefix: 'qing_hai',\n    projection: d3.geoConicEqualArea()\n      .parallels([15, 65])\n      .rotate([-110, 0])\n      .scale(2500)\n      .center([-6, 145]),\n    projectionMobile: d3.geoConicEqualArea()\n      .parallels([15, 65])\n      .rotate([-110, 0])\n      .scale(1700)\n      .center([0.8, 147]),\n    showMobileRegion: (label) => filterRegionNameByListAndLength(label, null, ['海东地区'], null),\n  },\n  '山东': {\n    filenamePrefix: 'shan_dong',\n    projection: d3.geoConicEqualArea()\n      .parallels([15, 65])\n      .rotate([-110, 0])\n      .scale(4600)\n      .center([12.8, 144.5]),\n    projectionMobile: d3.geoConicEqualArea()\n      .parallels([15, 65])\n      .rotate([-110, 0])\n      .scale(3300)\n      .center([15.8, 145.5]),\n    showMobileRegion: (label) => filterRegionNameByListAndLength(label, null, ['淄博市', '枣庄市', '日照市', '莱芜市', '东营市'], null),\n  },\n  '山西': {\n    filenamePrefix: 'shan_xi_1',\n    projection: d3.geoConicEqualArea()\n      .parallels([15, 65])\n      .rotate([-110, 0])\n      .scale(4500)\n      .center([8, 141.9]),\n    projectionMobile: d3.geoConicEqualArea()\n      .parallels([15, 65])\n      .rotate([-110, 0])\n      .scale(4500)\n      .center([8, 142.2]),\n  },\n  '陕西': {\n    filenamePrefix: 'shan_xi_3',\n    projection: d3.geoConicEqualArea()\n      .parallels([15, 65])\n      .rotate([-110, 0])\n      .scale(4000)\n      .center([3.5, 143.5]),\n    projectionMobile: d3.geoConicEqualArea()\n      .parallels([15, 65])\n      .rotate([-110, 0])\n      .scale(4200)\n      .center([4.1, 143.4]),\n  },\n  '上海': {\n    filenamePrefix: 'shang_hai',\n    projection: d3.geoConicEqualArea()\n      .parallels([15, 65])\n      .rotate([-110, 0])\n      .scale(26000)\n      .center([12.2, 148.7]),\n    projectionMobile: d3.geoConicEqualArea()\n      .parallels([15, 65])\n      .rotate([-110, 0])\n      .scale(18000)\n      .center([12.7, 148.9]),\n    showMobileRegion: (label) => filterRegionNameByListAndLength(label, null, ['普陀区', '长宁区', '静安区', '徐汇区', '虹口区'], null),\n    showRegion: (label) => filterRegionNameByListAndLength(label, null, ['普陀区', '长宁区', '虹口区'], null),\n  },\n  '四川': {\n    filenamePrefix: 'si_chuan',\n    projection: d3.geoConicEqualArea()\n      .parallels([15, 65])\n      .rotate([-110, 0])\n      .scale(3000)\n      .center([-1, 149.5]),\n    projectionMobile: d3.geoConicEqualArea()\n      .parallels([15, 65])\n      .rotate([-110, 0])\n      .scale(2100)\n      .center([4, 151.5]),\n    showMobileRegion: (label) => filterRegionNameByListAndLength(label, null, ['泸州市', '德阳市', '遂宁市', '自贡市', '资阳市', '达州市', '雅安市'], null),\n  },\n  '台湾': {\n    filenamePrefix: 'tai_wan',\n    projection: d3.geoConicEqualArea()\n      .parallels([15, 65])\n      .rotate([-110, 0])\n      .scale(6800)\n      .center([12.5, 156]),\n    projectionMobile: d3.geoConicEqualArea()\n      .parallels([15, 65])\n      .rotate([-110, 0])\n      .scale(6000)\n      .center([14.5, 157]),\n  },\n  '天津': {\n    filenamePrefix: 'tian_jin',\n    projection: d3.geoConicEqualArea()\n      .parallels([15, 65])\n      .rotate([-110, 0])\n      .scale(17000)\n      .center([9, 140.5]),\n    projectionMobile: d3.geoConicEqualArea()\n      .parallels([15, 65])\n      .rotate([-110, 0])\n      .scale(16000)\n      .center([9, 140.6]),\n    showMobileRegion: (label) => filterRegionNameByListAndLength(label, null, ['红桥区', '南开区', '河东区', '和平区', '河北区', '河西区'], null),\n  },\n  '西藏': {\n    filenamePrefix: 'xi_zang',\n    projection: d3.geoConicEqualArea()\n      .parallels([15, 65])\n      .rotate([-110, 0])\n      .scale(1700)\n      .center([-10.5, 149]),\n    projectionMobile: d3.geoConicEqualArea()\n      .parallels([15, 65])\n      .rotate([-110, 0])\n      .scale(1100)\n      .center([-0.5, 153]),\n  },\n  '香港': {\n    filenamePrefix: 'xiang_gang',\n    projection: d3.geoConicEqualArea()\n      .parallels([15, 65])\n      .rotate([-110, 0])\n      .scale(3000)\n      .center([10.1, 140.6]),\n    projectionMobile: d3.geoConicEqualArea()\n      .parallels([15, 65])\n      .rotate([-110, 0])\n      .scale(5500)\n      .center([11, 148])\n  },\n  '新疆': {\n    filenamePrefix: 'xin_jiang',\n    projection: d3.geoConicEqualArea()\n      .parallels([15, 65])\n      .rotate([-110, 0])\n      .scale(1600)\n      .center([-12.5, 138]),\n    projectionMobile: d3.geoConicEqualArea()\n      .parallels([15, 65])\n      .rotate([-110, 0])\n      .scale(1100)\n      .center([-1.3, 140]),\n    showMobileRegion: (label) => filterRegionNameByListAndLength(label, 5, ['阿克苏地区', '塔城地区', '五家渠市', '吐鲁番地区', '图木舒克市'], ['巴音郭楞蒙古自治州']),\n    showRegion: (label) => filterRegionNameByListAndLength(label, 5, ['阿克苏地区', '塔城地区', '五家渠市', '吐鲁番地区', '图木舒克市'], ['巴音郭楞蒙古自治州']),\n  },\n  '云南': {\n    filenamePrefix: 'yun_nan',\n    projection: d3.geoConicEqualArea()\n      .parallels([15, 65])\n      .rotate([-110, 0])\n      .scale(3500)\n      .center([-3.6, 153.8]),\n    projectionMobile: d3.geoConicEqualArea()\n      .parallels([15, 65])\n      .rotate([-110, 0])\n      .scale(2500)\n      .center([-.2, 155.3]),\n    showMobileRegion: (label) => filterRegionNameByListAndLength(label, 6, null, ['大理白族自治州']),\n    showRegion: (label) => filterRegionNameByListAndLength(label, 9, ['楚雄彝族自治州'], null),\n  },\n  '浙江': {\n    filenamePrefix: 'zhe_jiang',\n    projection: d3.geoConicEqualArea()\n      .parallels([15, 65])\n      .rotate([-110, 0])\n      .scale(6700)\n      .center([13, 151]),\n    projectionMobile: d3.geoConicEqualArea()\n      .parallels([15, 65])\n      .rotate([-110, 0])\n      .scale(4700)\n      .center([15, 152]),\n  }\n}\n\nexport const FILTER_MESSAGES: Record<FilterType, any> = {\n  confirmed: {\n    id: \"models.filters.confirmed\",\n    description: \"type filter for region\",\n    defaultMessage: \"确诊\"\n  },\n  deceased: {\n    id: \"models.filters.deceased\",\n    description: \"type filter for region\",\n    defaultMessage: \"死亡\"\n  },\n  discharged: {\n    id: \"models.filters.discharged\",\n    description: \"type filter for region\",\n    defaultMessage: \"治愈\"\n  },\n  suspected: {\n    id: \"models.filters.suspected\",\n    description: \"type filter for region\",\n    defaultMessage: \"疑似\"\n  }\n}\n\nexport const STRIP_KEY_PARTS = ['省', '市', '自治区', '回族', '维吾尔', '壮族'];\n\nexport const MOBILE_DISPLAY_PROVINCE = ['湖北省', '广东省', '四川省', '青海省', '新疆维吾尔自治区', '西藏自治区', '山西省', '黑龙江省', '浙江省', '云南省'];\nexport const NOT_MOBILE_REJECT_PROVINCE = ['北京市', '天津市', '上海市', '甘肃省'];\nexport const NOT_MOBILE_ACCEPT_PROVINCE = ['新疆维吾尔自治区', '西藏自治区', '内蒙古自治区'];\n\nexport const DATE_RANGE = [new Date(2020, 0, 24), new Date()];\n\nexport enum TextLabelDisplayLevel {\n  Disabled = 0,\n  Auto = 10,\n  Enabled = 20\n}\n","import React from 'react';\nimport { WithStyles } from \"@material-ui/styles/withStyles\";\nimport createStyles from \"@material-ui/styles/createStyles\";\nimport { Theme } from \"@material-ui/core/styles/createMuiTheme\";\nimport withStyles from \"@material-ui/core/styles/withStyles\";\nimport { useIntl, defineMessages, FormattedMessage } from \"react-intl\";\nimport { TextLabelDisplayLevel, IRegionData, FilterType, DATE_RANGE, FILTER_MESSAGES } from \"./models\";\nimport ToggleButton from '@material-ui/lab/ToggleButton';\nimport ToggleButtonGroup from '@material-ui/lab/ToggleButtonGroup';\nimport Card from '@material-ui/core/Card';\nimport CardContent from '@material-ui/core/CardContent';\nimport CardHeader from '@material-ui/core/CardHeader';\nimport Skeleton from '@material-ui/lab/Skeleton';\nimport { DatePicker } from \"@material-ui/pickers/DatePicker\";\nimport moment from 'moment';\nimport { darken } from \"@material-ui/core/styles/colorManipulator\";\nimport Link from '@material-ui/core/Link';\nimport FormControl from '@material-ui/core/FormControl';\nimport Select from '@material-ui/core/Select';\nimport MenuItem from '@material-ui/core/MenuItem';\nimport InputLabel from '@material-ui/core/InputLabel';\n\nconst LABEL_WIDTH: number = 120;\n\nconst styles = ({ spacing, palette }: Theme) => createStyles({\n  filterButton: {\n    minWidth: spacing(10),\n    color: darken(palette.text.primary, 0.2),\n    '& > *': {\n      display: 'block',\n    }\n  },\n  root: {\n    '& > *': {\n      margin: spacing(1, 1),\n    }\n  },\n  formControl: {\n    margin: spacing(1),\n    minWidth: LABEL_WIDTH,\n  },\n  share: {\n\n  }\n});\n\ninterface IDisplayBoardProps extends WithStyles<typeof styles> {\n  name: string | null;\n  subName?: string | null;\n  data: IRegionData | null;\n  filter: FilterType;\n  onClick: (e: React.MouseEvent<HTMLButtonElement, MouseEvent>, filter: FilterType) => void;\n  selectedDate: Date;\n  handleDateChange: (date: Date) => void;\n  redirectionHint?: () => void;\n  textLabelLevel: number;\n  setTextLabelLevel: React.Dispatch<React.SetStateAction<number>>;\n};\n\nconst messages = defineMessages({\n  date: {\n    id: \"display_board.date\",\n    description: \"datepick title\",\n    defaultMessage: \"日期\"\n  },\n});\n\nconst _DisplayBoard: React.FunctionComponent<IDisplayBoardProps> = ({ textLabelLevel, setTextLabelLevel, redirectionHint, filter, classes, name, subName, data, onClick, selectedDate, handleDateChange }) => {\n  const intl = useIntl();\n\n  const handleChangeEvent = (e: React.ChangeEvent<{\n    name?: string | undefined;\n    value: unknown;\n  }>) => {\n    e.preventDefault();\n    const num = parseInt(String(e.target.value));\n    setTextLabelLevel(isNaN(num) ? TextLabelDisplayLevel.Auto : num);\n  }\n\n  const onDateChange = (date: moment.Moment | null) => {\n    if (!date) { return; }\n    handleDateChange(date.toDate());\n  };\n\n  const [START_DATE, END_DATE] = DATE_RANGE;\n  return <Card>\n    <CardHeader title={name} subheader={subName} />\n    <CardContent className={classes.root}>\n      <DatePicker\n        disableToolbar\n        minDate={START_DATE}\n        maxDate={END_DATE}\n        // shouldDisableDate={shouldDisableDate}\n        format=\"MMMD日\"\n        variant=\"inline\"\n        label={intl.formatMessage(messages.date)}\n        value={selectedDate}\n        onChange={onDateChange}\n        inputVariant=\"outlined\"\n        animateYearScrolling\n      />\n      <FormControl variant=\"outlined\" className={classes.formControl}>\n        <InputLabel>\n          <FormattedMessage\n            id=\"display_board.label_switch\"\n            description=\"label_switch\"\n            defaultMessage=\"显示地区名\"\n          />\n        </InputLabel>\n        <Select\n          value={textLabelLevel}\n          onChange={handleChangeEvent}\n          labelWidth={LABEL_WIDTH}\n          inputProps={{\n          }}\n        >\n          <MenuItem value={TextLabelDisplayLevel.Auto}>\n            <FormattedMessage\n              id=\"display_board.label_switch.auto\"\n              description=\"label_switch\"\n              defaultMessage=\"自动\"\n            />\n          </MenuItem>\n          <MenuItem value={TextLabelDisplayLevel.Enabled}>\n            <FormattedMessage\n              id=\"display_board.label_switch.enable\"\n              description=\"label_switch\"\n              defaultMessage=\"启用\"\n            />\n          </MenuItem>\n          <MenuItem value={TextLabelDisplayLevel.Disabled}>\n            <FormattedMessage\n              id=\"display_board.label_switch.disable\"\n              description=\"label_switch\"\n              defaultMessage=\"禁用\"\n            />\n          </MenuItem>\n        </Select>\n      </FormControl>\n      <ToggleButtonGroup size=\"large\" color=\"primary\" aria-label=\"text primary button group\">\n        <ToggleButton value=\"confirmed\" selected={filter === \"confirmed\"} className={classes.filterButton} onClick={(e) => onClick(e, \"confirmed\")}>\n          <div>{intl.formatMessage(FILTER_MESSAGES[\"confirmed\"])}</div>\n          <div>{data ? data.confirmed : <Skeleton variant=\"text\" />}</div>\n        </ToggleButton>\n        <ToggleButton value=\"discharged\" selected={filter === \"discharged\"} className={classes.filterButton} onClick={(e) => onClick(e, \"discharged\")}>\n          <div>{intl.formatMessage(FILTER_MESSAGES[\"discharged\"])}</div>\n          <div>{data ? data.discharged : <Skeleton variant=\"text\" />}</div>\n        </ToggleButton>\n        <ToggleButton value=\"deceased\" selected={filter === \"deceased\"} className={classes.filterButton} onClick={(e) => onClick(e, \"deceased\")}>\n          <div>{intl.formatMessage(FILTER_MESSAGES[\"deceased\"])}</div>\n          <div>{data ? data.deceased : <Skeleton variant=\"text\" />}</div>\n        </ToggleButton>\n        {/* <Button className={classes.filterButton} onClick={(e) => onClick(e, \"suspected\")}>\n            <FormattedHTMLMessage\n              id=\"components.display_board.labels.suspected\"\n              description=\"Label used on display board\"\n              defaultMessage=\"疑似<br>{num}\"\n              values={{\n                num: data.suspected\n              }}\n            />\n          </Button> */}\n      </ToggleButtonGroup>\n      {redirectionHint && <React.Fragment><br /><Link onClick={redirectionHint}>\n        <FormattedMessage\n          id=\"display_board.goto\"\n          description=\"go to link on display board\"\n          defaultMessage=\"前往查看地区详情\"\n        />\n      </Link></React.Fragment>}\n    </CardContent>\n  </Card>;\n}\n\n\nconst DisplayBoard = withStyles(styles)(_DisplayBoard);\nexport default DisplayBoard;\n","import React, { useRef, useEffect } from 'react';\nimport * as d3 from \"d3\";\nimport { ExtendedFeature } from 'd3';\n\ninterface IGraphRendererProps<FeatureType extends ExtendedFeature = ExtendedFeature> {\n  features: FeatureType[];\n  fillFn: (d: d3.ExtendedFeature) => string;\n  geoGenerator: d3.GeoPath<any, d3.GeoPermissibleObjects>;\n  eventHandlers: Array<[string, (feature: ExtendedFeature) => void]>;\n  showTextLabel?: (label: string) => boolean;\n};\n\nconst GraphRenderer: React.FunctionComponent<IGraphRendererProps> = ({ showTextLabel, features, fillFn, geoGenerator, eventHandlers }) => {\n  const ref = useRef<SVGGElement>(null);\n\n  const renderGraph = () => {\n    d3.selectAll(\"g > *\").remove(); // TODO: seems we have to remove the nodes before repainting\n\n    if (!ref.current || !features) { return; }\n\n    const u = d3.select(ref.current)\n      .selectAll('path')\n      .data(features);\n\n    // u.enter is not available, I'm not sure about the type about u at that time.\n    if (!u || !u.enter) { return; }\n\n    const p = u.enter()\n      .append('path')\n      .attr('d', geoGenerator)\n      .attr(\"class\", \"region-item\")\n      .attr('stroke-width', 1)\n      .attr('stroke', \"#ffffff\")\n      .attr('fill', fillFn);\n\n      const t = u.enter()\n        .append('text')\n        .attr('transform', d => {\n          return `translate(${geoGenerator.centroid(d)})`;\n        })\n        .attr(\"class\", \"region-item-text\")\n        .attr('style', d => {\n          const label = d?.properties?.name;\n          if (!showTextLabel || !label) {\n            return null;\n          }\n          return showTextLabel(label) ? null : \"display: none\";\n        })\n        .text(d => d?.properties?.name);\n      t.exit().remove();\n\n    eventHandlers.forEach(([typenames, listener]) => {\n      p.on(typenames, listener);\n    });\n\n    u.exit().remove();\n  };\n  useEffect(renderGraph, [features, fillFn, eventHandlers]);\n\n  return <g ref={ref}></g>;\n}\n\nexport default GraphRenderer;\n","import * as React from 'react';\nimport { IDimension } from '../models';\n\nconst MIN_WIDTH = 500;\nconst MIN_HEIGHT = 400;\nconst MAX_HEIGHT = 800;\n\nexport function useMeasures(\n  geoGenerator: d3.GeoPath<any, d3.GeoPermissibleObjects>,\n  values: d3.ExtendedFeatureCollection\n): [\n  React.RefObject<HTMLElement>,\n  React.RefObject<HTMLDivElement>,\n  IDimension\n] {\n  const containerRef = React.createRef<HTMLElement>();\n  const measureRef = React.createRef<HTMLDivElement>();\n  const [dimension, setDimension] = React.useState({\n    width: MIN_WIDTH,\n    height: MIN_HEIGHT\n  });\n  \n  React.useEffect(() => {\n    if (measureRef.current && containerRef.current) {\n      const docRect = containerRef.current.getBoundingClientRect();\n      const measureRect = measureRef.current.getBoundingClientRect();\n      let height = docRect.height - measureRect.top;\n      const mapYBoundRaw = geoGenerator.bounds(values)[1][1];\n      let maxHeight = mapYBoundRaw >= Infinity || mapYBoundRaw <= -Infinity ? MAX_HEIGHT : mapYBoundRaw;\n      if (maxHeight < MIN_HEIGHT) {\n        maxHeight = MIN_HEIGHT;\n      }\n      height = Math.max(height, maxHeight);\n      if (height < MIN_HEIGHT) {\n        height = MIN_HEIGHT;\n      } else if (height > maxHeight) {\n        height = maxHeight;\n      }\n\n      if (height !== dimension.height || dimension.width !== measureRect.width) {\n        setDimension({\n          height,\n          width: measureRect.width\n        });\n      }\n    }\n  }, [measureRef, containerRef, dimension.height, dimension.width, geoGenerator, values]);\n  return [containerRef, measureRef, dimension];\n}\n","import MobileDetect from \"mobile-detect\";\n\nexport default function isMobile() {\n  const md = new MobileDetect(window.navigator.userAgent);\n  const res = md.mobile();\n  return res != null;\n} \n","import React, { useEffect, useCallback } from 'react';\nimport { WithStyles } from \"@material-ui/styles/withStyles\";\nimport createStyles from \"@material-ui/styles/createStyles\";\nimport { Theme } from \"@material-ui/core/styles/createMuiTheme\";\nimport withStyles from \"@material-ui/core/styles/withStyles\";\nimport { useIntl, defineMessages } from \"react-intl\";\nimport { useTitle } from \"react-use\";\nimport * as d3 from \"d3\";\nimport DisplayBoard from './DisplayBoard';\nimport { NOT_MOBILE_ACCEPT_PROVINCE, NOT_MOBILE_REJECT_PROVINCE, MOBILE_DISPLAY_PROVINCE, TextLabelDisplayLevel, IRegionData, AreaCsvItem, FilterType, FILL_FN_MAP, FILTER_MESSAGES, EMPTY_REGION_DATA, MOBILE_WIDTH_BREAKPOINT, BuildScale, FILTER_INTERPOLATION, FILL_FN_PROVINCE_MAP } from './models';\nimport Container from '@material-ui/core/Container';\nimport Grid from '@material-ui/core/Grid';\nimport CircularProgress from '@material-ui/core/CircularProgress';\nimport Paper from '@material-ui/core/Paper';\nimport GraphRenderer from './GraphRenderer';\nimport { AsyncState } from 'react-use/lib/useAsyncFn';\nimport { ExtendedFeatureCollection, ExtendedFeature } from 'd3';\nimport { useMeasures } from './helpers/useMeasures';\nimport isMobile from \"./helpers/isMobile\";\n\nconst styles = ({ spacing, transitions }: Theme) => createStyles({\n  gradLegend: {\n    height: spacing(10),\n    width: 315\n  }\n});\n\ninterface INationTabVisualizer extends WithStyles<typeof styles> {\n  params: URLSearchParams;\n  state: AsyncState<ExtendedFeatureCollection>;\n  dataState: AsyncState<d3.DSVParsedArray<AreaCsvItem>>;\n  moveOverRegionPanel: (name: string) => void;\n  filter: FilterType;\n  setFilter: (value: FilterType) => void;\n  selectedDate: Date;\n  handleDateChange: (date: Date) => void;\n};\n\nfunction PluckDataByFilter(data: IRegionData, filter: FilterType) {\n  return data[filter] || 0;\n}\n\nfunction TryGetDataFromPrefix(byProvince: d3.Map<IRegionData>, prefix: string) {\n  const keys = byProvince.keys();\n  const idx = keys.findIndex(p => p.startsWith(prefix));\n  if (idx !== -1) {\n    const data = byProvince.get(keys[idx]);\n    return data;\n  }\n  return undefined;\n}\n\nconst messages = defineMessages({\n  filters: FILTER_MESSAGES,\n  title: {\n    id: \"geovisualizer.title\",\n    description: \"title for geovisualizer\",\n    defaultMessage: \"{region}地区 - {filter}\"\n  },\n  nation: {\n    id: \"geovisualizer.nation\",\n    description: \"default (nation) filter for region\",\n    defaultMessage: \"全国\"\n  }\n});\n\ninterface IHoverItem {\n  duration: Date;\n  feature: ExtendedFeature;\n}\n\nconst _NationTabVisualizer: React.FunctionComponent<INationTabVisualizer> = ({ classes, selectedDate, handleDateChange, filter, setFilter, dataState, state, moveOverRegionPanel }) => {\n  const intl = useIntl();\n\n  const geoGenerator = d3.geoPath();\n  const [containerRef, measureRef, dimension] = useMeasures(geoGenerator, state.value!);\n\n  const projection = d3.geoConicEqualArea();\n  projection\n    .parallels([15, 65])\n    .rotate([-110, 0])\n    .scale(dimension.width > MOBILE_WIDTH_BREAKPOINT ? 800 : 450)\n    .center(dimension.width > MOBILE_WIDTH_BREAKPOINT ? [10.1, 140.6] : [39, 160]);\n\n  geoGenerator.projection(projection);\n\n  const [province, setProvince] = React.useState<string | null>(null);\n  const name = province || intl.formatMessage(messages.nation);\n  useTitle(intl.formatMessage(messages.title, { region: name, filter: intl.formatMessage(messages.filters[filter]) }));\n\n  const [byProvince, setByProvince] = React.useState<d3.Map<IRegionData>>(d3.map<IRegionData>({}));\n\n  useEffect(() => {\n    const data = dataState.value;\n    if (!data) { return; }\n    const byDate = data.reduce((h: Record<string, AreaCsvItem[]>, obj: AreaCsvItem) => Object.assign(h, { [obj.updatedAtDate]: (h[obj.updatedAtDate] || []).concat(obj) }), {})\n\n    let chosenDate = selectedDate.toISOString().substr(0, 10);\n    const extracted = byDate[chosenDate];\n    if (!extracted) {\n      const newDate = Object.keys(byDate)[0];\n      console.log(`error date ${chosenDate}, switching to ${newDate}`);\n      handleDateChange(new Date(newDate));\n      return;\n    }\n    const byProvince = d3.nest<AreaCsvItem, IRegionData>().key(d => d.name).rollup(d => d[0]).map(extracted);\n    setByProvince(byProvince);\n  }, [dataState, selectedDate, handleDateChange]);\n\n  const values = byProvince.values().map(d => d[filter]);\n  const domain = [d3.min(values) || 0, d3.max(values) || 1000];\n  const fillFn = BuildScale(FILL_FN_MAP, filter)\n    .interpolate(() => FILTER_INTERPOLATION[filter])\n    .domain(domain);\n\n  const fn = useCallback((d: ExtendedFeature) => {\n\n    const provinceName = d.properties?.name as string;\n    let num = 0;\n    const data = TryGetDataFromPrefix(byProvince, provinceName);\n    if (data) {\n      num = PluckDataByFilter(data, filter);\n    }\n    return fillFn ? fillFn(num) : '#eeeeee';\n  }, [byProvince, fillFn, filter]);\n\n  const handleFilterClicked = (e: React.MouseEvent<HTMLButtonElement, MouseEvent>, filter: FilterType) => {\n    e.preventDefault();\n    setFilter(filter);\n  };\n\n  const [data, setData] = React.useState<IRegionData | null>(null);\n\n  React.useEffect(() => {\n    if (province) {\n      const data = TryGetDataFromPrefix(byProvince, province);\n      if (data) {\n        setData(data);\n      }\n    } else {\n      if (byProvince.size() === 0) {\n        return;\n      }\n      const total = byProvince.entries().reduce((acc, item) => {\n        const { value } = item;\n        return {\n          confirmed: acc.confirmed + value.confirmed,\n          discharged: acc.discharged + value.discharged,\n          deceased: acc.deceased + value.deceased,\n          suspected: acc.suspected + value.suspected\n        }\n      }, EMPTY_REGION_DATA);\n      setData(total);\n    }\n\n  }, [province, byProvince]);\n\n  const [pinned, setPinned] = React.useState<boolean>(false);\n  const [hovered, setHovered] = React.useState<IHoverItem | null>(null);\n\n  const onItemOver = React.useCallback((ele: SVGPathElement, d: ExtendedFeature) => {\n    d3.selectAll(\".region-item\")\n      .transition()\n      .duration(300)\n      .style(\"opacity\", 0.5);\n    d3.select<SVGPathElement, ExtendedFeature>(ele)\n      .transition()\n      .duration(300)\n      .style(\"opacity\", 1)\n      .style(\"stroke\", \"black\");\n    if (pinned) { return; }\n    const name = d?.properties?.name;\n    if (name) {\n      setProvince(name);\n    }\n  }, [pinned]);\n\n  const onMouseOver = React.useCallback(function (this: SVGPathElement, d: ExtendedFeature) {\n    onItemOver(this, d);\n  }, [onItemOver]);\n\n  const onMouseClick = React.useCallback((d: ExtendedFeature) => {\n    if (hovered?.duration || hovered?.feature?.properties?.name === d?.properties?.name) {\n      const now = new Date();\n      const diff = now.getTime() - (hovered !== null ? hovered.duration.getTime() : 0);\n      console.log(\"click \", diff);\n      if (diff <= 500) {\n        return;\n      }\n    }\n\n    setPinned(true);\n\n    const name = d?.properties?.name;\n    if (name) {\n      setProvince(name);\n      moveOverRegionPanel(name);\n    }\n\n    setHovered(null);\n\n  }, [hovered, moveOverRegionPanel]);\n\n  const onMouseOut = React.useCallback((d: ExtendedFeature) => {\n    if (pinned) { return; }\n\n    setProvince(null);\n  }, [pinned]);\n\n  const eventHandlers: Array<[string, (feature: ExtendedFeature) => void]> = [\n    [\"mouseover\", onMouseOver],\n    [\"click\", onMouseClick],\n    [\"mouseout\", onMouseOut]\n  ];\n\n  const redirectionHint = () => {\n    if (province) {\n      moveOverRegionPanel(province);\n    }\n  }\n\n  const isMobileDevice = isMobile();\n  const [textLabelLevel, setTextLabelLevel] = React.useState<number>(TextLabelDisplayLevel.Auto);\n  const showTextLabel = React.useCallback((label: string) => {\n    if (textLabelLevel <= 0) { return false; }\n    else if (textLabelLevel > 10) { return true; }\n\n    if (isMobileDevice) {\n      return MOBILE_DISPLAY_PROVINCE.indexOf(label) !== -1;\n    } else {\n      return (label.length <= 4 && NOT_MOBILE_REJECT_PROVINCE.indexOf(label) === -1) || NOT_MOBILE_ACCEPT_PROVINCE.indexOf(label) !== -1;\n    }\n  }, [textLabelLevel, isMobileDevice]);\n\n  const gradRef = React.createRef<HTMLDivElement>();\n  React.useEffect(() => {\n    if (!gradRef.current || !filter) { return; }\n\n    var w = 300, h = 30;\n\n    var key = d3.select(gradRef.current);\n    key.selectAll(\"*\").remove();\n    const s = key\n      .append(\"svg\")\n      .attr(\"width\", w + 15)\n      .attr(\"height\", h)\n      .attr('class', 'grad-legend-svg');\n\n    var legend = s.append(\"defs\")\n      .append(\"svg:linearGradient\")\n      .attr(\"id\", \"gradient\")\n      .attr(\"x1\", \"0%\")\n      .attr(\"y1\", \"100%\")\n      .attr(\"x2\", \"100%\")\n      .attr(\"y2\", \"100%\")\n      .attr(\"spreadMethod\", \"pad\");\n\n    legend.append(\"stop\")\n      .attr(\"offset\", \"0%\")\n      .attr(\"stop-color\", fillFn(domain[0]))\n      .attr(\"stop-opacity\", 1);\n\n    legend.append(\"stop\")\n      .attr(\"offset\", \"100%\")\n      .attr(\"stop-color\", fillFn(domain[1]))\n      .attr(\"stop-opacity\", 1);\n\n    s.append(\"rect\")\n      .attr(\"width\", w)\n      .attr(\"height\", 10)\n      .style(\"fill\", \"url(#gradient)\");\n\n    var y = BuildScale(FILL_FN_PROVINCE_MAP, filter)\n      .range([0, 300])\n      .domain(domain);\n\n    var yAxis = d3.axisBottom<number>(d3.scaleBand<number>())\n      .scale(y)\n      .ticks(4);\n\n    s.append(\"g\")\n      .attr(\"class\", \"y axis\")\n      .attr(\"transform\", \"translate(0,10)\")\n      .call(yAxis)\n      .append(\"text\")\n      .attr(\"transform\", \"rotate(-90)\")\n      .attr(\"y\", 0)\n      .attr(\"dy\", \"1em\")\n      .style(\"text-anchor\", \"end\")\n      .text(\"axis title\");\n  }, [gradRef, fillFn, filter, domain]);\n\n  return <Container ref={containerRef}>\n    <Grid container spacing={3}>\n      <Grid item md={4} xs={12}>\n        <DisplayBoard\n          filter={filter}\n          onClick={handleFilterClicked}\n          name={name}\n          data={data}\n          selectedDate={selectedDate}\n          handleDateChange={handleDateChange}\n          textLabelLevel={textLabelLevel}\n          setTextLabelLevel={setTextLabelLevel}\n          redirectionHint={province && isMobile() ? redirectionHint : undefined}\n        />\n      </Grid>\n      <Grid item md={8} xs={12}>\n        <Paper ref={measureRef}>\n          {state.loading || dataState.loading ? <CircularProgress /> :\n            <React.Fragment>\n              <svg width={dimension.width} height={dimension.height} className=\"container\">\n                <GraphRenderer\n                  geoGenerator={geoGenerator}\n                  features={state.value?.features!}\n                  showTextLabel={showTextLabel}\n                  fillFn={fn}\n                  eventHandlers={eventHandlers} />\n              </svg>\n              <div className={classes.gradLegend} ref={gradRef}></div>\n            </React.Fragment>}\n        </Paper>\n      </Grid>\n    </Grid>\n  </Container>;\n}\nconst NationTabVisualizer = withStyles(styles)(_NationTabVisualizer);\nexport default NationTabVisualizer;\n","import { STRIP_KEY_PARTS } from \"../models\";\n\nexport function stripRegionNameForKey(region: string | null): string {\n  if (!region) { return \"\"; }\n  return STRIP_KEY_PARTS.reduce((acc: string, v) => { return acc.replace(v, \"\") }, region || \"\");\n}\n","import React, { useEffect, useCallback } from 'react';\nimport { WithStyles } from \"@material-ui/styles/withStyles\";\nimport createStyles from \"@material-ui/styles/createStyles\";\nimport { Theme } from \"@material-ui/core/styles/createMuiTheme\";\nimport withStyles from \"@material-ui/core/styles/withStyles\";\nimport { useIntl, defineMessages, FormattedMessage } from \"react-intl\";\nimport { useTitle, useAsync } from \"react-use\";\nimport * as d3 from \"d3\";\nimport DisplayBoard from './DisplayBoard';\nimport { TextLabelDisplayLevel, IRegionData, AreaCsvItem, FilterType, FILL_FN_PROVINCE_MAP, PROVINCE_META_MAP, FILTER_MESSAGES, EMPTY_REGION_DATA, IProvinceMeta, MOBILE_WIDTH_BREAKPOINT, BuildScale, FILTER_INTERPOLATION } from './models';\nimport Container from '@material-ui/core/Container';\nimport Grid from '@material-ui/core/Grid';\nimport GraphRenderer from './GraphRenderer';\nimport { AsyncState } from 'react-use/lib/useAsyncFn';\nimport { ExtendedFeatureCollection, ExtendedFeature } from 'd3';\nimport { useMeasures } from './helpers/useMeasures';\nimport { stripRegionNameForKey } from './helpers/sanitizers';\nimport CircularProgress from '@material-ui/core/CircularProgress';\nimport Table from '@material-ui/core/Table';\nimport TableHead from '@material-ui/core/TableHead';\nimport TableBody from '@material-ui/core/TableBody';\nimport TableCell from '@material-ui/core/TableCell';\nimport TableContainer from '@material-ui/core/TableContainer';\nimport TableRow from '@material-ui/core/TableRow';\nimport Paper from '@material-ui/core/Paper';\nimport { emphasize } from \"@material-ui/core/styles/colorManipulator\";\nimport isMobile from './helpers/isMobile';\n\nconst styles = ({ spacing, palette }: Theme) => createStyles({\n  container: {},\n  highlightRow: {\n    backgroundColor: emphasize(palette.background.default, 0.3)\n  },\n  gradLegend: {\n    height: spacing(10),\n    width: 315\n  }\n});\n\ninterface IProvinceTabVisualizer extends WithStyles<typeof styles> {\n  state: AsyncState<ExtendedFeatureCollection>;\n  params: URLSearchParams;\n  filter: FilterType;\n  setFilter: (value: FilterType) => void;\n  selectedDate: Date;\n  handleDateChange: (date: Date) => void;\n};\n\n\nfunction PluckDataByFilter(data: IRegionData, filter: FilterType) {\n  return data[filter] || 0;\n}\n\nfunction TryGetDataFromPrefix(byMapped: d3.Map<IRegionData>, prefix: string) {\n  prefix = stripRegionNameForKey(prefix);\n  const keys = byMapped.keys();\n  const idx = keys.findIndex(p => p.startsWith(prefix));\n  if (idx !== -1) {\n    const data = byMapped.get(keys[idx]);\n    return data;\n  }\n  return undefined;\n}\n\nconst messages = defineMessages({\n  filters: FILTER_MESSAGES,\n  title: {\n    id: \"geovisualizer.title\",\n    description: \"title for geovisualizer\",\n    defaultMessage: \"{region}地区 - {filter}\"\n  },\n  all: {\n    id: \"provinces.all\",\n    description: \"province display card\",\n    defaultMessage: '所有地区'\n  }\n});\n\nfunction getProvinceMeta(key: string): IProvinceMeta | null {\n  if (Object.keys(PROVINCE_META_MAP).indexOf(key) !== -1) {\n    return PROVINCE_META_MAP[key];\n  }\n  return null;\n}\n\nconst _ProvinceTabVisualizer: React.FunctionComponent<IProvinceTabVisualizer> = ({ classes, filter, setFilter, params, state, selectedDate, handleDateChange }) => {\n  const intl = useIntl();\n\n  const geoGenerator = d3.geoPath();\n  const [province] = React.useState<string | null>(params.get(\"province\"));\n  const provinceKey = stripRegionNameForKey(province);\n  const provinceMeta = getProvinceMeta(provinceKey);\n  if (provinceMeta === null) {\n    throw new Error(\"似乎出问题了。找不到这个省份。试试退后上一页或者刷新。\");\n  };\n  const [containerRef, measureRef, dimension] = useMeasures(geoGenerator, state.value!);\n\n  geoGenerator.projection(dimension.width > MOBILE_WIDTH_BREAKPOINT ? provinceMeta.projection : provinceMeta.projectionMobile);\n\n  const [city, setCity] = React.useState<string | null>(null);\n  const [byCity, setByCity] = React.useState<d3.Map<IRegionData>>(d3.map<IRegionData>({}));\n  const name = city === null ? province || \"\" : `${province} / ${city}`;\n  useTitle(intl.formatMessage(messages.title, { region: name, filter: intl.formatMessage(messages.filters[filter]) }));\n\n  const dataState = useAsync<d3.DSVParsedArray<AreaCsvItem>>(async () => {\n    if (!provinceKey || provinceKey.length === 0) { return new Promise(resolve => { }); }\n\n    return d3.csv(`/data/provinces/${provinceMeta.filenamePrefix}.csv`, (d) => {\n      // drop missing item\n      if (!d.name || !d.confirmed || !d.discharged || !d.deceased || !d.suspected || !d.updatedAtDate) {\n        return null;\n      }\n      const item: AreaCsvItem = {\n        name: d.name,\n        confirmed: parseInt(d.confirmed),\n        discharged: parseInt(d.discharged),\n        deceased: parseInt(d.deceased),\n        suspected: parseInt(d.suspected),\n        updatedAtDate: d.updatedAtDate\n      };\n      return item;\n    });\n  });\n\n  useEffect(() => {\n    const data = dataState?.value;\n    if (!data) { return; }\n    const byDate = data.reduce((h: Record<string, AreaCsvItem[]>, obj: AreaCsvItem) => Object.assign(h, { [obj.updatedAtDate]: (h[obj.updatedAtDate] || []).concat(obj) }), {})\n\n    let chosenDate = selectedDate.toISOString().substr(0, 10);\n    const extracted = byDate[chosenDate];\n    if (!extracted) {\n      const newDate = Object.keys(byDate)[0];\n      if (!newDate) { return; }\n      console.log(`error date ${chosenDate}, switching to ${newDate}`);\n      handleDateChange(new Date(newDate));\n      return;\n    }\n    const byCity = d3.nest<AreaCsvItem, IRegionData>().key(d => d.name).rollup(d => d[0]).map(extracted);\n    setByCity(byCity);\n  }, [dataState, selectedDate, handleDateChange]);\n\n  const values = byCity.values().map(d => d[filter]);\n  const domain = [0, d3.max(values) || 60];\n  const fillFn = BuildScale(FILL_FN_PROVINCE_MAP, filter)\n    .interpolate(() => FILTER_INTERPOLATION[filter])\n    .domain(domain);\n\n  const fn = useCallback((d: ExtendedFeature) => {\n    const provinceName = d.properties?.name as string;\n    let num = 0;\n    const data = TryGetDataFromPrefix(byCity, provinceName);\n    if (data) {\n      num = PluckDataByFilter(data, filter);\n    }\n\n    return fillFn ? fillFn(num) : '#eeeeee';\n  }, [byCity, filter, fillFn]);\n\n  const handleFilterClicked = (e: React.MouseEvent<HTMLButtonElement, MouseEvent>, filter: FilterType) => {\n    e.preventDefault();\n    setFilter(filter);\n  };\n\n  const [data, setData] = React.useState<IRegionData | null>(null);\n\n  React.useEffect(() => {\n    if (city) {\n      // TODO: looks more cleansing to do\n      const data = TryGetDataFromPrefix(byCity, city.replace('市', ''));\n      if (data) {\n        setData(data);\n      }\n    } else {\n      if (byCity.size() === 0) {\n        return;\n      }\n      const total = byCity.entries().reduce((acc, item) => {\n        const { value } = item;\n        return {\n          confirmed: acc.confirmed + value.confirmed,\n          discharged: acc.discharged + value.discharged,\n          deceased: acc.deceased + value.deceased,\n          suspected: acc.suspected + value.suspected\n        }\n      }, EMPTY_REGION_DATA);\n      setData(total);\n    }\n\n  }, [city, byCity]);\n\n  const [pinned, setPinned] = React.useState<boolean>(false);\n\n  const onMouseOver = React.useCallback(function (this: SVGPathElement, d: ExtendedFeature) {\n    d3.selectAll(\".region-item\")\n      .transition()\n      .duration(300)\n      .style(\"opacity\", 0.5);\n    d3.select<SVGPathElement, ExtendedFeature>(this)\n      .transition()\n      .duration(300)\n      .style(\"opacity\", 1)\n      .style(\"stroke\", \"black\");\n    if (pinned) { return; }\n    const name = d?.properties?.name;\n    if (name) {\n      setCity(name);\n    }\n  }, [pinned]);\n\n  const onMouseClick = React.useCallback((d: ExtendedFeature) => {\n\n    const name = d?.properties?.name;\n    if (name) {\n      if (city === name) {\n        setPinned(!pinned);\n      } else {\n        setPinned(true);\n      }\n      setCity(name);\n    }\n    // moveOverRegionPanel(d);\n  }, [city, pinned]);\n\n  const onMouseOut = React.useCallback((d: ExtendedFeature) => {\n    if (pinned) { return; }\n\n    setCity(null);\n  }, [pinned]);\n\n  const eventHandlers: Array<[string, (feature: ExtendedFeature) => void]> = [\n    [\"mouseover\", onMouseOver],\n    [\"click\", onMouseClick],\n    [\"mouseout\", onMouseOut]\n  ];\n\n  const isMobileDevice = isMobile();\n  const [textLabelLevel, setTextLabelLevel] = React.useState<number>(TextLabelDisplayLevel.Auto);\n  const showTextLabel = React.useCallback((label: string) => {\n    if (textLabelLevel <= 0) { return false; }\n    else if (textLabelLevel > 10) { return true; }\n    \n    if (isMobileDevice) {\n      return provinceMeta.showMobileRegion ? provinceMeta.showMobileRegion(label) : true;\n    } else {\n      return provinceMeta.showRegion ? provinceMeta.showRegion(label) : true;\n    }\n  }, [textLabelLevel, isMobileDevice, provinceMeta]);\n\n  const gradRef = React.createRef<HTMLDivElement>();\n  React.useEffect(() => {\n    if (!gradRef.current || !filter) { return; }\n\n    var w = 300, h = 30;\n\n    var key = d3.select(gradRef.current);\n    key.selectAll(\"*\").remove();\n    const s = key\n      .append(\"svg\")\n      .attr(\"width\", w+15)\n      .attr(\"height\", h)\n      .attr('class', 'grad-legend-svg');\n\n    var legend = s.append(\"defs\")\n      .append(\"svg:linearGradient\")\n      .attr(\"id\", \"gradient\")\n      .attr(\"x1\", \"0%\")\n      .attr(\"y1\", \"100%\")\n      .attr(\"x2\", \"100%\")\n      .attr(\"y2\", \"100%\")\n      .attr(\"spreadMethod\", \"pad\");\n\n    legend.append(\"stop\")\n      .attr(\"offset\", \"0%\")\n      .attr(\"stop-color\", fillFn(domain[0]))\n      .attr(\"stop-opacity\", 1);\n\n    legend.append(\"stop\")\n      .attr(\"offset\", \"100%\")\n      .attr(\"stop-color\", fillFn(domain[1]))\n      .attr(\"stop-opacity\", 1);\n\n    s.append(\"rect\")\n      .attr(\"width\", w)\n      .attr(\"height\", 10)\n      .style(\"fill\", \"url(#gradient)\");\n\n    var y = BuildScale(FILL_FN_PROVINCE_MAP, filter)\n      .range([0, 300])\n      .domain(domain);\n\n    var yAxis = d3.axisBottom<number>(d3.scaleBand<number>())\n      .scale(y)\n      .ticks(4);\n\n    s.append(\"g\")\n      .attr(\"class\", \"y axis\")\n      .attr(\"transform\", \"translate(0,10)\")\n      .call(yAxis)\n      .append(\"text\")\n      .attr(\"transform\", \"rotate(-90)\")\n      .attr(\"y\", 0)\n      .attr(\"dy\", \"1em\")\n      .style(\"text-anchor\", \"end\")\n      .text(\"axis title\");\n  }, [gradRef, fillFn, filter, domain]);\n\n\n  return <Container ref={containerRef} className={classes.container}>\n    <Grid container spacing={3}>\n      <Grid item md={4} xs={12}>\n        <DisplayBoard\n          filter={filter}\n          onClick={handleFilterClicked}\n          name={province}\n          subName={city || intl.formatMessage(messages.all)}\n          data={data}\n          textLabelLevel={textLabelLevel}\n          setTextLabelLevel={setTextLabelLevel}\n          selectedDate={selectedDate}\n          handleDateChange={handleDateChange}\n        />\n      </Grid>\n      <Grid item md={8} xs={12}>\n        <Paper ref={measureRef}>\n          {state.loading || dataState.loading ? <CircularProgress /> : <React.Fragment>\n            <svg width={dimension.width} height={dimension.height} className=\"container\">\n              <GraphRenderer\n                geoGenerator={geoGenerator}\n                features={state.value?.features!}\n                showTextLabel={showTextLabel}\n                fillFn={fn}\n                eventHandlers={eventHandlers} />\n            </svg>\n            <div className={classes.gradLegend} ref={gradRef}></div>\n            </React.Fragment>}\n        </Paper>\n      </Grid>\n      {!(state.loading || dataState.loading) && <Grid item xs={12}>\n        <TableContainer component={Paper}>\n          <Table size=\"small\">\n            <TableHead>\n              <TableRow>\n                <TableCell>\n                  <FormattedMessage\n                    id=\"geovisualizer.region\"\n                    description=\"filter region\"\n                    defaultMessage=\"地区\"\n                  />\n                </TableCell>\n                <TableCell align=\"right\">{intl.formatMessage(FILTER_MESSAGES.confirmed)}</TableCell>\n                <TableCell align=\"right\">{intl.formatMessage(FILTER_MESSAGES.discharged)}</TableCell>\n                <TableCell align=\"right\">{intl.formatMessage(FILTER_MESSAGES.deceased)}</TableCell>\n              </TableRow>\n            </TableHead>\n            <TableBody>\n              {byCity.values().map((row, idx) => {\n                return <TableRow key={idx} className={row.name === stripRegionNameForKey(city) ? classes.highlightRow : undefined}>\n                  <TableCell>{row.name}</TableCell>\n                  <TableCell align=\"right\">{row.confirmed}</TableCell>\n                  <TableCell align=\"right\">{row.discharged}</TableCell>\n                  <TableCell align=\"right\">{row.deceased}</TableCell>\n                </TableRow>\n              })}\n            </TableBody>\n          </Table>\n        </TableContainer>\n      </Grid>}\n    </Grid>\n  </Container>;\n}\n\nconst ProvinceTabVisualizer = withStyles(styles)(_ProvinceTabVisualizer);\nexport default ProvinceTabVisualizer;\n","import React from 'react';\nimport { WithStyles } from \"@material-ui/styles/withStyles\";\nimport createStyles from \"@material-ui/styles/createStyles\";\nimport { Theme } from \"@material-ui/core/styles/createMuiTheme\";\nimport withStyles from \"@material-ui/core/styles/withStyles\";\nimport { useIntl, defineMessages, FormattedMessage } from \"react-intl\";\nimport { useTitle } from \"react-use\";\nimport Container from '@material-ui/core/Container';\nimport Grid from '@material-ui/core/Grid';\nimport Card from '@material-ui/core/Card';\nimport CardContent from '@material-ui/core/CardContent';\nimport Typography from '@material-ui/core/Typography';\n\nconst styles = ({ spacing, transitions }: Theme) => createStyles({\n  container: {}\n});\n\ninterface IAboutProps extends WithStyles<typeof styles> {\n};\n\nconst messages = defineMessages({\n  title: {\n    id: \"about.title\",\n    description: \"title for about\",\n    defaultMessage: \"关于\"\n  }\n});\n\n// // @ts-ignore\n// function linesToParagraphs(...nodes) {\n//   console.log(nodes);\n//   return nodes.map((node, idx) => node.props.children\n//     .map((node: any) => typeof node === 'string' ? \n//         node.split('\\n').map((text, idx2) => <p key={(idx+1)*1000+idx2+1}>{text}</p>) : node)\n//     .reduce((nodes: any, node: any) => nodes.concat(node), []));\n// }\n\nconst _About: React.FunctionComponent<IAboutProps> = ({ classes }) => {\n  const intl = useIntl();\n  useTitle(intl.formatMessage(messages.title));\n\n  return <Container className={classes.container}>\n    <Grid container spacing={3}>\n      <Grid item xs={12}>\n        <Card>\n          <CardContent>\n            <Typography>\n            <FormattedMessage\n              id=\"about.content.main\"\n              description=\"desc\"\n              defaultMessage=\"链接直达。交互式存档。无论你需要看哪个地方，哪一天的信息，只要到那个页面，分享或者保存链接，就永远可以找到那。\n\n              继续阅读：{caixin}、{caixin2}、{github}\"\n              values={{\n                github: <a href=\"https://github.com/fantasticfears-stage/ncov-zh\">GitHub 代码</a>,\n                caixin: <a href=\"http://weekly.caixin.com/2020/cw891/\">财新周刊-抢救新冠病人</a>,\n                caixin2: <a href=\"http://m.app.caixin.com/m_topic_detail/1473.html\">财新-新冠肺炎防疫全纪录（限时免费）</a>\n              }}\n            />\n            </Typography>\n          </CardContent>\n        </Card>\n      </Grid>\n    </Grid>\n  </Container>;\n}\n\nconst About = withStyles(styles)(_About);\nexport default About;\n","import * as React from \"react\";\nimport { WithStyles } from \"@material-ui/styles/withStyles\";\nimport createStyles from \"@material-ui/styles/createStyles\";\nimport { Theme } from \"@material-ui/core/styles/createMuiTheme\";\nimport withStyles from \"@material-ui/core/styles/withStyles\";\n\nexport interface IErrorBoundaryState {\n  hasError: boolean;\n}\n\nconst styles = ({ palette, spacing, transitions, zIndex, mixins, breakpoints }: Theme) => createStyles({\n});\n\nexport interface IErrorBoundaryProps extends WithStyles<typeof styles> {\n}\n\nconst ErrorBoundary = withStyles(styles)(\n  class extends React.Component<IErrorBoundaryProps, IErrorBoundaryState> {\n    constructor(props: IErrorBoundaryProps) {\n      super(props);\n      this.state = { hasError: false };\n    }\n\n    static getDerivedStateFromError: React.GetDerivedStateFromError<IErrorBoundaryProps, IErrorBoundaryState> = (error) => {\n      // Update state so the next render will show the fallback UI.\n      console.log(error);\n      return { hasError: true };\n    }\n\n    componentDidCatch(error: Error, errorInfo: React.ErrorInfo) {\n      console.log(error, errorInfo);\n\n      // You can also log the error to an error reporting service\n      // logErrorToMyService(error, errorInfo);\n    }\n\n    render() {\n      if (this.state.hasError) {\n        // You can render any custom fallback UI\n        return <h1>Something went wrong.</h1>;\n      }\n\n      return this.props.children;\n    }\n  }\n);\n\nexport default ErrorBoundary;\n","import React, { useEffect } from 'react';\nimport { WithStyles } from \"@material-ui/styles/withStyles\";\nimport createStyles from \"@material-ui/styles/createStyles\";\nimport { Theme } from \"@material-ui/core/styles/createMuiTheme\";\nimport withStyles from \"@material-ui/core/styles/withStyles\";\nimport CssBaseline from '@material-ui/core/CssBaseline';\nimport { RouteComponentProps, navigate } from \"@reach/router\";\nimport { useIntl, defineMessages } from \"react-intl\";\nimport { useAsync } from \"react-use\";\nimport * as d3 from \"d3\";\nimport { ExtendedFeatureCollection } from 'd3';\nimport NationTabVisualizer from \"./NationTabVisualizer\";\nimport { AreaCsvItem, PROVINCE_META_MAP, FilterType, STRIP_KEY_PARTS } from './models';\nimport AppBar from '@material-ui/core/AppBar';\nimport Tabs from '@material-ui/core/Tabs';\nimport Tab from '@material-ui/core/Tab';\nimport Typography from '@material-ui/core/Typography';\nimport useMediaQuery from '@material-ui/core/useMediaQuery';\nimport useTheme from '@material-ui/core/styles/useTheme';\nimport ProvinceTabVisualizer from './ProvinceTabVisualizer';\nimport About from \"./About\";\nimport ErrorBoundary from './ErrorBoundary';\n\nconst styles = ({ spacing, mixins }: Theme) => createStyles({\n  appBarSpacer: {\n    minHeight: spacing(3)\n  }\n});\n\ninterface IGeoVisualizerRoutes {\n\n}\n\ntype TabType = 'nation-tab' | 'region-tab' | 'about-tab';\n\ninterface IGeoVisualizerProps extends RouteComponentProps<IGeoVisualizerRoutes>, WithStyles<typeof styles> {\n\n};\n\nconst messages = defineMessages({\n  region: {\n    id: \"geovisualizer.region\",\n    description: \"filter for region\",\n    defaultMessage: \"点击地图选择地区\"\n  },\n  nation: {\n    id: \"geovisualizer.nation\",\n    description: \"default (nation) filter for region\",\n    defaultMessage: \"全国\"\n  },\n  about: {\n    id: \"geovisualizer.about\",\n    description: \"about tab\",\n    defaultMessage: \"关于\"\n  }\n});\n\nfunction TabPanel(props: any) {\n  const { children, value, index, ...other } = props;\n  return (\n    <Typography\n      component=\"div\"\n      role=\"tabpanel\"\n      hidden={value !== index}\n      id={`wrapped-tabpanel-${index}`}\n      aria-labelledby={`wrapped-tab-${index}`}\n      {...other}\n    >\n      {value === index && children}\n    </Typography>\n  );\n}\nfunction a11yProps(index: string) {\n  return {\n    id: `wrapped-tab-${index}`,\n    'aria-controls': `wrapped-tabpanel-${index}`,\n  };\n}\nconst _GeoVisualizer: React.FunctionComponent<IGeoVisualizerProps> = ({ classes, location, path }) => {\n  const intl = useIntl();\n\n  const state = useAsync<ExtendedFeatureCollection>(async () => {\n    return d3.json(\"/data/china.json\");\n  });\n\n  const dataState = useAsync<d3.DSVParsedArray<AreaCsvItem>>(async () => {\n    return d3.csv(\"/data/provinces.csv\", (d) => {\n      // drop missing item\n      if (!d.name || !d.confirmed || !d.discharged || !d.deceased || !d.suspected || !d.updatedAtDate) {\n        return null;\n      }\n      const item: AreaCsvItem = {\n        name: d.name,\n        confirmed: parseInt(d.confirmed),\n        discharged: parseInt(d.discharged),\n        deceased: parseInt(d.deceased),\n        suspected: parseInt(d.suspected),\n        updatedAtDate: d.updatedAtDate\n      };\n      return item;\n    });\n  });\n\n  const params = new URLSearchParams(location?.search);\n  const [region, setRegion] = React.useState<string | null>(params.get('province'));\n  let defaultValue: TabType = \"nation-tab\";\n  if (path?.startsWith(\"/about\")) {\n    defaultValue = \"about-tab\";\n  } else if (path?.startsWith(\"/region\")) {\n    defaultValue = 'region-tab';\n  }\n  const [value, setValue] = React.useState<TabType>(defaultValue);\n\n  const stateProvince = useAsync<ExtendedFeatureCollection>(React.useCallback(async () => {\n    const regionKey: string = STRIP_KEY_PARTS.reduce((acc: string, v) => { return acc.replace(v, \"\") }, region || \"\");\n\n    return Object.keys(PROVINCE_META_MAP).indexOf(regionKey) === -1 ?\n      new Promise<ExtendedFeatureCollection>((resolve, reject) => { reject(); }) :\n      d3.json(`/data/provinces/${PROVINCE_META_MAP[regionKey].filenamePrefix}_geo.json`);\n  }, [region]));\n\n  const handleChange = (event: React.ChangeEvent<{}>, newValue: any) => {\n    setValue(newValue);\n  };\n\n  const getRegionUrl = React.useCallback((regionName: string) => {\n    params.set('province', regionName);\n    const redirectUrl = `region?${params}`;\n    return redirectUrl;\n  }, [params]);\n\n  const moveOverRegionPanel = React.useCallback((regionName: string) => {\n    setRegion(regionName);\n    const redirectUrl = getRegionUrl(regionName);\n    navigate(redirectUrl);\n  }, [getRegionUrl]);\n\n  const theme = useTheme();\n  const matches = useMediaQuery(theme.breakpoints.up('md'));\n\n  const routeFilter = params.get(\"filter\")?.trim() || \"\";\n  let defaultFilter: FilterType = \"confirmed\";\n  if (['confirmed', 'deceased', 'discharged'].indexOf(routeFilter) !== -1) {\n    defaultFilter = routeFilter as FilterType;\n  }\n  const [filter, setFilter] = React.useState<FilterType>(defaultFilter);\n  useEffect(() => {\n    if (params.get('filter') !== filter) {\n      params.set('filter', filter);\n    }\n  }, [filter, params]);\n  const setFilterPushingHistory = (value: FilterType) => {\n    setFilter(value);\n    params.set(\"filter\", value);\n    navigate(`${location?.pathname || \"/\"}?${params}`);\n  };\n\n  const now = new Date();\n  const paramDate = params.get('date');\n  const defaultDate = paramDate !== null ? new Date(paramDate) : now;\n  const [selectedDate, setSelectedDate] = React.useState(defaultDate);\n\n  const handleDateChange = React.useCallback((date: Date) => {\n    setSelectedDate(date);\n\n    console.log(date);\n    params.set('date', date.toISOString().substr(0, 10));\n    navigate(`${path}?${params}`);\n  }, [params, path]);\n\n  return <div>\n    <CssBaseline />\n    <ErrorBoundary>\n      <AppBar position=\"static\">\n        <Tabs value={value} onChange={handleChange} centered={matches}>\n          <Tab\n            value=\"nation-tab\"\n            label={intl.formatMessage(messages.nation)}\n            onClick={() => {\n              // params.delete('province');\n              navigate(`/?${params}`);\n            }}\n            {...a11yProps('nation-tab')}\n          />\n          <Tab\n            value=\"region-tab\"\n            disabled={!region}\n            label={region === null ? intl.formatMessage(messages.region) : region}\n            onClick={() => { navigate(`/region?${params}`) }}\n            {...a11yProps('region-tab')}\n          />\n          <Tab\n            value=\"about-tab\"\n            label={intl.formatMessage(messages.about)}\n            onClick={() => { navigate(`/about?${params}`) }}\n            {...a11yProps('about-tab')}\n          />\n        </Tabs>\n      </AppBar>\n      <div className={classes.appBarSpacer} />\n      <TabPanel value={value} index=\"nation-tab\">\n        <NationTabVisualizer\n          params={params}\n          state={state}\n          dataState={dataState}\n          moveOverRegionPanel={moveOverRegionPanel}\n          filter={filter}\n          setFilter={setFilterPushingHistory}\n          selectedDate={selectedDate}\n          handleDateChange={handleDateChange}\n        />\n      </TabPanel>\n      <TabPanel value={value} index=\"region-tab\">\n        <ProvinceTabVisualizer\n          params={params}\n          state={stateProvince}\n          filter={filter}\n          setFilter={setFilterPushingHistory}\n          selectedDate={selectedDate}\n          handleDateChange={handleDateChange}\n        />\n      </TabPanel>\n      <TabPanel value={value} index=\"about-tab\">\n        <About\n        />\n      </TabPanel>\n    </ErrorBoundary>\n  </div>;\n}\n\nconst GeoVisualizer = withStyles(styles)(_GeoVisualizer);\n\nexport default GeoVisualizer;\n","import { PaletteOptions, Palette } from \"@material-ui/core/styles/createPalette\";\nimport { TypographyOptions } from \"@material-ui/core/styles/createTypography\";\n\nconst palette: PaletteOptions = {\n};\n\nconst typography: TypographyOptions | ((palette: Palette) => TypographyOptions) = {\n  h1: {\n    fontSize: \"6rem\"\n  },\n  h2: {\n    fontSize: \"3.75rem\"\n  },\n  h3: {\n    fontSize: \"3rem\"\n  },\n  h4: {\n    fontSize: \"2.125rem\"\n  },\n  h5: {\n    fontSize: \"1.5rem\"\n  },\n  h6: {\n    fontSize: \"1.25rem\"\n  }\n}\n\nexport { palette, typography };\n","import React from 'react';\nimport './App.css';\nimport { Router } from \"@reach/router\";\nimport GeoVisualizer from \"./GeoVisualizer\";\nimport { IntlProvider } from 'react-intl';\nimport ThemeProvider from \"@material-ui/styles/ThemeProvider\";\nimport useMediaQuery from '@material-ui/core/useMediaQuery';\nimport createMuiTheme from \"@material-ui/core/styles/createMuiTheme\";\nimport { palette, typography } from \"./theme\";\nimport MomentUtils from '@date-io/moment';\nimport { MuiPickersUtilsProvider } from '@material-ui/pickers/MuiPickersUtilsProvider';\nimport { useEffectOnce } from 'react-use';\nimport moment from 'moment';\nimport 'moment/locale/zh-cn';\n\nconst App = () => {\n  let locale = \"en\"; // default is en by react-intl. this trick should work for a while if translation is ever needed\n  const prefersDarkMode = useMediaQuery('(prefers-color-scheme: dark)');\n  const theme = React.useMemo(\n    () =>\n      createMuiTheme({\n        palette: Object.assign({\n          type: prefersDarkMode ? 'dark' : 'light',\n        }, palette),\n        typography\n      }),\n    [prefersDarkMode],\n  );\n\n  useEffectOnce(() => {\n    moment.updateLocale('zh-cn', {\n      longDateFormat : {\n        LT : 'HH:mm',\n        LTS : 'HH:mm:ss',\n        L : 'YYYY-MM-DD',\n        LL : 'D MMMM YYYY',\n        LLL : 'D MMMM YYYY HH:mm',\n        LLLL : 'dddd D MMMM YYYY HH:mm'\n      },\n    });\n  });\n\n  return <IntlProvider locale={locale}>\n    <ThemeProvider theme={theme}>\n      <MuiPickersUtilsProvider utils={MomentUtils}>\n        <Router>\n          <GeoVisualizer path=\"/\" />\n          <GeoVisualizer path=\"/region\" />\n          <GeoVisualizer path=\"/about\" />\n        </Router>\n      </MuiPickersUtilsProvider>\n    </ThemeProvider>\n  </IntlProvider>;\n}\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      process.env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}